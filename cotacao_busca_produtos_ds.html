<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solução Câmera - WhatsApp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border-top: 8px solid #10b981;
        }
        .solution-step {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        .permission-guide {
            background: #fef3cd;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
        .urgent-alert {
            background: #fee2e2;
            border: 2px solid #ef4444;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
        <script>
    // =============================================
    // DETECTOR GITHUB PAGES + TESTE CÂMERA AUTOMÁTICO
    // =============================================
    function checkGitHubPages() {
        console.log('🔍 Verificando ambiente...');
        
        // Verifica se está no GitHub Pages
        if (window.location.hostname.includes('github.io')) {
            console.log('✅ GitHub Pages detectado');
            
            // Atualiza o diagnóstico
            const diagnosis = document.getElementById('diagnosisResult');
            if (diagnosis) {
                diagnosis.innerHTML = `
                    <div class="text-green-700 font-semibold">
                        ✅ GitHub Pages - Ambiente OK!
                        <p class="text-sm font-normal mt-1">Câmera deve funcionar perfeitamente</p>
                    </div>
                `;
            }
            
            addToLog('🌐 Executando em GitHub Pages - HTTPS ativo');
            
            // Testa a câmera automaticamente após 3 segundos
            setTimeout(() => {
                testCameraOnGitHubPages();
            }, 3000);
        } else {
            addToLog('⚠️ Ambiente local - Câmera pode não funcionar');
        }
    }

    async function testCameraOnGitHubPages() {
        try {
            addToLog('📷 Testando câmera automaticamente...');
            
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            });
            
            addToLog('🎉 CÂMERA FUNCIONANDO PERFEITAMENTE!');
            
            // Para a câmera após o teste
            stream.getTracks().forEach(track => track.stop());
            
            // Atualiza interface
            const diagnosis = document.getElementById('diagnosisResult');
            if (diagnosis) {
                diagnosis.innerHTML = `
                    <div class="text-green-700 font-semibold">
                        🎉 SUCESSO TOTAL! Câmera liberada!
                        <p class="text-sm font-normal mt-1">Agora você pode escanear códigos</p>
                    </div>
                `;
            }
            
        } catch (error) {
            addToLog('❌ Câmera ainda com problema: ' + error.message);
            console.error('Erro câmera:', error);
        }
    }

    // Função auxiliar para logs (se não existir)
    function addToLog(message) {
        const log = document.getElementById('permissionLog') || document.getElementById('systemLog');
        if (log) {
            log.innerHTML += `<div>> ${new Date().toLocaleTimeString()} - ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }
        console.log(message);
    }
    </script>
</head>
<body class="flex items-center justify-center p-4">
    <div class="card w-full max-w-2xl p-6">
        <!-- Alerta Urgente -->
        <div class="urgent-alert">
            <div class="flex items-center mb-2">
                <span class="text-2xl mr-2">🚨</span>
                <h2 class="text-lg font-bold text-red-800">PROBLEMA IDENTIFICADO</h2>
            </div>
            <p class="text-red-700 text-sm">
                <strong>Você está abrindo do WhatsApp → Arquivo local → Câmera bloqueada</strong>
            </p>
        </div>

        <h1 class="text-2xl font-bold text-gray-800 mb-2 text-center">
            🔧 Solução Definitiva
        </h1>
        <p class="text-gray-600 text-center mb-6">Para funcionar quando aberto do WhatsApp</p>

        <!-- Diagnóstico Específico -->
        <div class="bg-blue-50 p-4 rounded-lg mb-6">
            <h3 class="font-semibold text-blue-800 mb-2">🔍 Diagnóstico WhatsApp:</h3>
            <div id="whatsappDiagnosis" class="text-sm text-blue-700">
                Analisando seu contexto...
            </div>
        </div>

        <!-- SOLUÇÕES EM ORDEM DE PRIORIDADE -->
        <div class="mb-6">
            <h3 class="font-semibold text-gray-700 mb-3">🎯 SOLUÇÕES (Do Mais Fácil ao Mais Eficaz):</h3>
            
            <!-- Solução 1: Copiar Link -->
            <div class="permission-guide">
                <h4 class="font-bold text-yellow-800 mb-2">1️⃣ SOLUÇÃO RÁPIDA (Recomendada):</h4>
                <button onclick="copyDeployLink()" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-lg transition duration-200 mb-2">
                    📋 COPIAR LINK PARA DEPLOY
                </button>
                <p class="text-sm text-yellow-800">Use serviços gratuitos para hospedar online</p>
            </div>

            <!-- Solução 2: Abrir no Chrome -->
            <div class="permission-guide mt-4">
                <h4 class="font-bold text-yellow-800 mb-2">2️⃣ SOLUÇÃO INTERMEDIÁRIA:</h4>
                <button onclick="openInChrome()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-lg transition duration-200 mb-2">
                    🌐 ABRIR NO CHROME
                </button>
                <p class="text-sm text-yellow-800">Força a abertura no navegador padrão</p>
            </div>

            <!-- Solução 3: Manual -->
            <div class="permission-guide mt-4">
                <h4 class="font-bold text-yellow-800 mb-2">3️⃣ SOLUÇÃO MANUAL:</h4>
                <div class="text-sm text-yellow-800 space-y-2">
                    <p><strong>Passo a passo:</strong></p>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>Toque nos <strong>3 pontos</strong> no Chrome</li>
                        <li><strong>"Abrir no Chrome"</strong> (se disponível)</li>
                        <li>Ou salve o arquivo e abra manualmente</li>
                        <li>Configure permissões de câmera</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- SERVIÇOS DE DEPLOY GRATUITOS -->
        <div class="bg-purple-50 p-4 rounded-lg mb-6">
            <h3 class="font-semibold text-purple-800 mb-3">🚀 Hospedagem Gratuita (5 minutos):</h3>
            <div class="grid grid-cols-1 gap-2 text-sm">
                <div class="flex items-center p-2 bg-white rounded border">
                    <span class="mr-2">📁</span>
                    <span><strong>Netlify Drop:</strong> Arraste o arquivo HTML</span>
                </div>
                <div class="flex items-center p-2 bg-white rounded border">
                    <span class="mr-2">⚡</span>
                    <span><strong>Vercel:</strong> Upload direto</span>
                </div>
                <div class="flex items-center p-2 bg-white rounded border">
                    <span class="mr-2">🌐</span>
                    <span><strong>GitHub Pages:</strong> Para versão final</span>
                </div>
            </div>
            <button onclick="showDeployTutorial()" class="w-full mt-3 bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 rounded transition duration-200">
                📖 Ver Tutorial Completo
            </button>
        </div>

        <!-- TESTE SIMULADO (Funciona Sempre) -->
        <div class="bg-green-50 p-4 rounded-lg mb-6">
            <h3 class="font-semibold text-green-800 mb-2">🧪 Teste Imediato (Simulação):</h3>
            <p class="text-sm text-green-700 mb-3">Teste o sistema enquanto resolve a hospedagem:</p>
            <button onclick="startAdvancedSimulation()" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-lg transition duration-200">
                🎯 Testar com Códigos Reais
            </button>
        </div>

        <!-- Resultado do Teste -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Código Escaneado:
            </label>
            <input type="text" id="testCodeResult" 
                   class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white font-mono text-center text-lg"
                   placeholder="---"
                   readonly>
        </div>

        <!-- Log de Atividades -->
        <div>
            <h3 class="font-semibold text-gray-700 mb-2">📝 Log do Sistema:</h3>
            <div id="systemLog" class="bg-gray-800 text-green-400 p-3 rounded font-mono text-sm max-h-32 overflow-y-auto">
                <div>> Sistema otimizado para WhatsApp carregado</div>
            </div>
        </div>
    </div>

    <!-- Modal de Tutorial -->
    <div id="tutorialModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">🚀 Tutorial: Hospedagem Rápida</h3>
            <div class="space-y-3 text-sm">
                <div class="flex items-start">
                    <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2 flex-shrink-0">1</span>
                    <span>Acesse <strong>netlify.com/drop</strong></span>
                </div>
                <div class="flex items-start">
                    <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2 flex-shrink-0">2</span>
                    <span>Arraste seu arquivo HTML para a área</span>
                </div>
                <div class="flex items-start">
                    <span class="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2 flex-shrink-0">3</span>
                    <span>Pronto! Você terá uma URL HTTPS</span>
                </div>
                <div class="flex items-start">
                    <span class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2 flex-shrink-0">4</span>
                    <span>Compartilhe essa URL no WhatsApp</span>
                </div>
            </div>
            <button onclick="closeTutorial()" class="w-full mt-4 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded">
                Fechar
            </button>
        </div>
    </div>

    <script>
        // --- BANCO DE DADOS REAL ---
        const productDatabase = [
            { codigo: '123456', descricao: 'MONITOR LED 24" FULL HD', vlUnit: '599.90', unidade: 'UN' },
            { codigo: '789012', descricao: 'MOUSE GAMER RGB', vlUnit: '89.90', unidade: 'UN' },
            { codigo: '345678', descricao: 'TECLADO MECÂNICO RGB', vlUnit: '199.90', unidade: 'UN' },
            { codigo: '112233', descricao: 'MOUSE PAD GAMER GRANDE', vlUnit: '49.90', unidade: 'UN' },
            { codigo: '456789', descricao: 'WEBCAM 1080P PROFISSIONAL', vlUnit: '159.90', unidade: 'UN' }
        ];

        // --- DIAGNÓSTICO WHATSAPP ---
        function diagnoseWhatsAppContext() {
            addToLog('🔍 Analisando contexto WhatsApp...');
            
            const diagnosis = document.getElementById('whatsappDiagnosis');
            let issues = [];
            
            // Verifica se é file://
            if (window.location.protocol === 'file:') {
                issues.push('❌ Arquivo local (file://) - Câmera BLOQUEADA');
                issues.push('❌ HTTPS necessário para câmera');
                issues.push('✅ Problema identificado corretamente');
            }
            
            // Verifica user agent do WhatsApp
            const userAgent = navigator.userAgent.toLowerCase();
            if (userAgent.includes('whatsapp')) {
                issues.push('⚠️ Detectado via WhatsApp');
            }
            
            if (issues.length > 0) {
                diagnosis.innerHTML = `
                    <div class="text-red-700">
                        <strong>Problemas encontrados:</strong>
                        <ul class="list-disc list-inside mt-1">
                            ${issues.map(issue => `<li>${issue}</li>`).join('')}
                        </ul>
                        <p class="mt-2 font-semibold">🎯 Use as soluções abaixo</p>
                    </div>
                `;
            }
            
            addToLog('✅ Diagnóstico completo');
        }

        // --- SOLUÇÃO 1: COPIAR LINK DEPLOY ---
        function copyDeployLink() {
            addToLog('📋 Preparando link para deploy...');
            
            const deployText = `🚀 HOSPEDAGEM GRATUITA para sua aplicação:

1️⃣ Netlify Drop: netlify.com/drop
2️⃣ Vercel: vercel.com/new
3️⃣ GitHub Pages: pages.github.com

📁 Arraste seu arquivo HTML e tenha uma URL HTTPS em 2 minutos!

💡 Isso resolverá o problema da câmera!`;
            
            // Tenta usar a Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(deployText)
                    .then(() => {
                        addToLog('✅ Link copiado! Cole no seu navegador');
                        alert('📋 Link copiado! Agora cole no seu navegador para fazer o deploy.');
                    })
                    .catch(err => {
                        fallbackCopy(deployText);
                    });
            } else {
                fallbackCopy(deployText);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            addToLog('✅ Link copiado (método alternativo)');
            alert('📋 Link copiado! Cole no seu navegador.');
        }

        // --- SOLUÇÃO 2: ABRIR NO CHROME ---
        function openInChrome() {
            addToLog('🌐 Tentando abrir no Chrome...');
            
            // Tenta detectar se está no WebView do WhatsApp
            if (navigator.userAgent.includes('WhatsApp')) {
                addToLog('⚠️ No WebView do WhatsApp. Use a Solução 1 (Deploy)');
                alert('📱 Para melhor experiência, use a Solução 1 (Deploy Online)');
                return;
            }
            
            // Tenta redirecionar para intent do Android
            const currentUrl = window.location.href;
            const chromeIntent = `intent://${currentUrl.replace('file://', '')}#Intent;scheme=file;package=com.android.chrome;end`;
            
            addToLog('🔧 Use a Solução 1 para resultado garantido');
            alert('🌐 Para funcionar 100%, use a Solução 1 (Deploy Online)');
        }

        // --- SIMULAÇÃO AVANÇADA ---
        function startAdvancedSimulation() {
            addToLog('🎯 Iniciando simulação realista...');
            
            const realCodes = ['123456', '789012', '345678', '112233', '456789'];
            let codeIndex = 0;
            
            function simulateNextCode() {
                if (codeIndex < realCodes.length) {
                    const code = realCodes[codeIndex];
                    addToLog(`📷 Simulando leitura: ${code}`);
                    
                    // Animação de escaneamento
                    document.getElementById('testCodeResult').value = 'Escaneando...';
                    document.getElementById('testCodeResult').classList.add('border-yellow-500', 'bg-yellow-50', 'animate-pulse');
                    
                    setTimeout(() => {
                        processScannedCode(code);
                        codeIndex++;
                        
                        if (codeIndex < realCodes.length) {
                            setTimeout(simulateNextCode, 2500);
                        } else {
                            addToLog('✅ Simulação concluída!');
                        }
                    }, 2000);
                }
            }
            
            simulateNextCode();
        }

        function processScannedCode(code) {
            document.getElementById('testCodeResult').value = code;
            document.getElementById('testCodeResult').classList.remove('border-yellow-500', 'bg-yellow-50', 'animate-pulse');
            document.getElementById('testCodeResult').classList.add('border-green-500', 'bg-green-50');
            
            const product = productDatabase.find(p => p.codigo === code);
            if (product) {
                addToLog(`✅ ${product.descricao} - R$ ${product.vlUnit}`);
                
                // Feedback visual adicional
                showProductToast(product);
            } else {
                addToLog(`❌ Código ${code} não encontrado`);
            }
        }

        function showProductToast(product) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300';
            toast.innerHTML = `
                <div class="font-semibold">✅ Produto Encontrado!</div>
                <div class="text-sm">${product.descricao}</div>
                <div class="text-sm font-bold">R$ ${product.vlUnit}</div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // --- TUTORIAL MODAL ---
        function showDeployTutorial() {
            document.getElementById('tutorialModal').classList.remove('hidden');
            document.getElementById('tutorialModal').classList.add('flex');
            addToLog('📖 Abrindo tutorial de deploy');
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').classList.add('hidden');
            document.getElementById('tutorialModal').classList.remove('flex');
        }

        // --- FUNÇÕES AUXILIARES ---
        function addToLog(message) {
            const log = document.getElementById('systemLog');
            log.innerHTML += `<div>> ${new Date().toLocaleTimeString()} - ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // --- INICIALIZAÇÃO ---
        window.onload = function() {
            addToLog('Sistema otimizado para WhatsApp carregado');
            diagnoseWhatsAppContext();
            
            // Detecta se está em file://
            if (window.location.protocol === 'file:') {
                addToLog('🚨 MODO LOCAL DETECTADO - Câmera não funcionará');
            }
        };

        // Fecha modal clicando fora
        document.getElementById('tutorialModal').addEventListener('click', function(e) {
            if (e.target === this) closeTutorial();
        });
    </script>
</body>
<script>
    // =============================================
    // INICIALIZADOR AUTOMÁTICO
    // =============================================
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Iniciando sistema GitHub Pages...');
        
        // Aguarda 1 segundo e verifica o ambiente
        setTimeout(() => {
            checkGitHubPages();
        }, 1000);
        
        // Adiciona botão de teste rápido se não existir
        addQuickTestButton();
    });
    
    function addQuickTestButton() {
        // Adiciona um botão de teste rápido se necessário
        const existingButton = document.querySelector('#quickTestBtn');
        if (!existingButton) {
            const testBtn = document.createElement('button');
            testBtn.id = 'quickTestBtn';
            testBtn.textContent = '🚀 Testar Câmera Agora';
            testBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                border: none;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 14px;
                cursor: pointer;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            testBtn.onclick = testCameraOnGitHubPages;
            document.body.appendChild(testBtn);
        }
    }
    </script>
</html>
