<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Cota√ß√£o - Integra√ß√£o com Leitor QR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .step-card {
            background: #f8fafc;
            border-left: 4px solid #10b981;
            border-radius: 8px;
        }
        .product-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
    </style>
</head>

<body class="flex items-center justify-center p-4">
    <div class="card w-full max-w-2xl p-6">
        <!-- Cabe√ßalho -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">
                üè™ Sistema de Cota√ß√£o
            </h1>
            <p class="text-gray-600">Integra√ß√£o com Leitor de C√≥digo de Barras</p>
        </div>

        <!-- M√©todo 1: Usar App Externo (RECOMENDADO) -->
        <div class="step-card p-4 mb-6">
            <h3 class="font-bold text-gray-800 mb-3">üéØ M√âTODO 1: Use seu App "Leitor QR"</h3>
            
            <div class="space-y-3">
                <div class="flex items-start">
                    <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-2 mt-1 flex-shrink-0">1</span>
                    <span>Abra o app <strong>"Leitor QR"</strong> no seu celular</span>
                </div>
                
                <div class="flex items-start">
                    <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-2 mt-1 flex-shrink-0">2</span>
                    <span>Aponte para o c√≥digo de barras e <strong>leia o c√≥digo</strong></span>
                </div>
                
                <div class="flex items-start">
                    <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-2 mt-1 flex-shrink-0">3</span>
                    <span>Cole o c√≥digo lido aqui:</span>
                </div>
                
                <div class="flex gap-2 mt-2">
                    <input type="text" id="scannedCode" 
                           placeholder="Cole aqui o c√≥digo lido pelo app"
                           class="flex-1 p-3 border border-gray-300 rounded-lg text-center font-mono text-lg">
                    <button onclick="processScannedCode()" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-4 rounded-lg">
                        ‚úÖ Buscar
                    </button>
                </div>
            </div>
        </div>

        <!-- M√©todo 2: Leitor Web (Alternativo) -->
        <div class="step-card p-4 mb-6">
            <h3 class="font-bold text-gray-800 mb-3">üì± M√âTODO 2: Leitor Web (Teste)</h3>
            
            <div class="text-center">
                <button onclick="openWebScanner()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-lg mb-2">
                    üì∑ Tentar Leitor Web
                </button>
                <p class="text-sm text-gray-600">Pode n√£o funcionar em todos os celulares</p>
            </div>
        </div>

        <!-- Campo de Entrada R√°pida -->
        <div class="bg-white border border-gray-200 rounded-lg p-4 mb-6">
            <h3 class="font-semibold text-gray-800 mb-3">‚å®Ô∏è Entrada R√°pida</h3>
            
            <div class="flex gap-2 mb-3">
                <input type="text" id="quickInput" 
                       placeholder="Digite o c√≥digo manualmente"
                       class="flex-1 p-3 border border-gray-300 rounded-lg text-center font-mono"
                       maxlength="20">
                <button onclick="processQuickInput()" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold px-4 rounded-lg">
                    üîç Buscar
                </button>
            </div>
            
            <div class="grid grid-cols-2 gap-2">
                <button onclick="fillCode('1234567')" class="p-2 bg-gray-100 hover:bg-gray-200 rounded text-sm">
                    1234567 - Arroz
                </button>
                <button onclick="fillCode('7654321')" class="p-2 bg-gray-100 hover:bg-gray-200 rounded text-sm">
                    7654321 - Feij√£o
                </button>
                <button onclick="fillCode('1122334')" class="p-2 bg-gray-100 hover:bg-gray-200 rounded text-sm">
                    1122334 - √ìleo
                </button>
                <button onclick="fillCode('9730000')" class="p-2 bg-gray-100 hover:bg-gray-200 rounded text-sm">
                    9730000 - Teste
                </button>
            </div>
        </div>

        <!-- Resultado -->
        <div id="result" class="hidden">
            <div class="product-card p-4 mb-4">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-bold text-lg" id="productName">Nome do Produto</h3>
                    <span class="bg-white text-purple-600 px-2 py-1 rounded text-sm font-mono" id="productCode">0000000</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div>Pre√ßo:</div>
                    <div class="font-bold" id="productPrice">R$ 0,00</div>
                    <div>Marca:</div>
                    <div id="productBrand">Marca</div>
                    <div>Estoque:</div>
                    <div id="productStock">Dispon√≠vel</div>
                    <div>Categoria:</div>
                    <div id="productCategory">Categoria</div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="addToQuote()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-lg">
                    üõí Adicionar
                </button>
                <button onclick="newSearch()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg">
                    üîÑ Novo Scan
                </button>
            </div>
        </div>

        <!-- Carrinho -->
        <div id="cart" class="hidden mt-6">
            <h3 class="font-bold text-gray-800 mb-3">üìã Itens da Cota√ß√£o</h3>
            <div id="cartItems" class="space-y-2 mb-3">
                <!-- Itens do carrinho -->
            </div>
            <div class="flex justify-between items-center font-bold text-lg border-t pt-3">
                <span>Total:</span>
                <span id="cartTotal">R$ 0,00</span>
            </div>
        </div>

        <!-- Status -->
        <div id="status" class="mt-4 text-center">
            <div class="text-sm text-gray-600">
                ‚ö° Use o app "Leitor QR" e cole o c√≥digo acima
            </div>
        </div>
    </div>

    <!-- Modal Web Scanner -->
    <div id="webScannerModal" class="hidden fixed inset-0 bg-black z-50">
        <div class="absolute top-4 left-0 right-0 text-center text-white z-10">
            <div class="text-lg font-bold">üì∑ Leitor Web</div>
            <div class="text-sm">Aponte para o c√≥digo de barras</div>
        </div>
        
        <div id="webScanner" class="w-full h-full bg-black">
            <!-- O scanner ser√° inserido aqui -->
        </div>
        
        <button onclick="closeWebScanner()" class="absolute bottom-4 left-0 right-0 mx-auto w-32 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-lg">
            üî¥ Fechar
        </button>
    </div>

    <script>
        // --- BANCO DE DADOS ---
        const productDatabase = {
            '1234567': {
                descricao: 'ARROZ TIO JO√ÉO 5KG',
                preco: '24.90',
                marca: 'Tio Jo√£o',
                estoque: '45 unidades',
                categoria: 'Alimentos'
            },
            '7654321': {
                descricao: 'FEIJ√ÉO CARIOCA 1KG',
                preco: '8.90',
                marca: 'Camil',
                estoque: '32 unidades',
                categoria: 'Alimentos'
            },
            '1122334': {
                descricao: '√ìLEO DE SOJA 900ML',
                preco: '6.50',
                marca: 'Liza',
                estoque: '28 unidades', 
                categoria: 'Alimentos'
            },
            '9730000': {
                descricao: 'PRODUTO TESTE',
                preco: '12.50',
                marca: 'Marca Teste',
                estoque: '100 unidades',
                categoria: 'Teste'
            }
        };

        let cart = [];

        // --- PROCESSAR C√ìDIGO DO APP EXTERNO ---
        function processScannedCode() {
            const input = document.getElementById('scannedCode');
            const code = input.value.trim();
            
            if (!code) {
                showStatus('‚ö†Ô∏è Cole o c√≥digo lido pelo app primeiro', 'red');
                input.focus();
                return;
            }
            
            processProductCode(code);
            input.value = ''; // Limpa o campo
        }

        // --- PROCESSAR ENTRADA R√ÅPIDA ---
        function processQuickInput() {
            const input = document.getElementById('quickInput');
            const code = input.value.trim();
            
            if (!code) {
                showStatus('‚ö†Ô∏è Digite um c√≥digo primeiro', 'red');
                input.focus();
                return;
            }
            
            processProductCode(code);
            input.value = '';
        }

        // --- PREENCHER C√ìDIGO ---
        function fillCode(code) {
            document.getElementById('scannedCode').value = code;
            document.getElementById('quickInput').value = code;
            showStatus(`‚úÖ C√≥digo ${code} preenchido! Clique em Buscar`, 'blue');
        }

        // --- PROCESSAR C√ìDIGO DO PRODUTO ---
        function processProductCode(code) {
            showStatus('üîç Buscando produto...', 'blue');
            
            // Simula delay de busca
            setTimeout(() => {
                const product = productDatabase[code];
                
                if (product) {
                    showProductResult(code, product);
                    showStatus('‚úÖ Produto encontrado!', 'green');
                } else {
                    showProductNotFound(code);
                    showStatus('‚ùå Produto n√£o encontrado', 'red');
                }
            }, 500);
        }

        // --- MOSTRAR RESULTADO ---
        function showProductResult(code, product) {
            document.getElementById('productName').textContent = product.descricao;
            document.getElementById('productCode').textContent = code;
            document.getElementById('productPrice').textContent = `R$ ${product.preco}`;
            document.getElementById('productBrand').textContent = product.marca;
            document.getElementById('productStock').textContent = product.estoque;
            document.getElementById('productCategory').textContent = product.categoria;
            
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('cart').classList.remove('hidden');
            
            // Scroll para o resultado
            setTimeout(() => {
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // --- PRODUTO N√ÉO ENCONTRADO ---
        function showProductNotFound(code) {
            document.getElementById('productName').textContent = 'PRODUTO N√ÉO CADASTRADO';
            document.getElementById('productCode').textContent = code;
            document.getElementById('productPrice').textContent = '---';
            document.getElementById('productBrand').textContent = '---';
            document.getElementById('productStock').textContent = '---';
            document.getElementById('productCategory').textContent = '---';
            
            document.getElementById('result').classList.remove('hidden');
        }

        // --- ADICIONAR √Ä COTA√á√ÉO ---
        function addToQuote() {
            const code = document.getElementById('productCode').textContent;
            const product = productDatabase[code];
            
            if (product) {
                const existingItem = cart.find(item => item.codigo === code);
                
                if (existingItem) {
                    existingItem.quantidade += 1;
                } else {
                    cart.push({
                        codigo: code,
                        descricao: product.descricao,
                        preco: product.preco,
                        quantidade: 1
                    });
                }
                
                updateCartDisplay();
                showStatus('‚úÖ Produto adicionado √† cota√ß√£o!', 'green');
            }
        }

        // --- ATUALIZAR CARRINHO ---
        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="text-center text-gray-500 py-2">Nenhum item</div>';
                cartTotal.textContent = 'R$ 0,00';
                return;
            }
            
            let total = 0;
            let itemsHTML = '';
            
            cart.forEach((item, index) => {
                const itemTotal = parseFloat(item.preco) * item.quantidade;
                total += itemTotal;
                
                itemsHTML += `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                        <div class="flex-1">
                            <div class="font-semibold text-sm">${item.descricao}</div>
                            <div class="text-xs text-gray-600">
                                R$ ${item.preco} √ó ${item.quantidade}
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-green-700 text-sm">R$ ${itemTotal.toFixed(2)}</span>
                            <button onclick="removeFromCart(${index})" class="text-red-500 text-xs">
                                ‚ùå
                            </button>
                        </div>
                    </div>
                `;
            });
            
            cartItems.innerHTML = itemsHTML;
            cartTotal.textContent = `R$ ${total.toFixed(2)}`;
        }

        // --- REMOVER DO CARRINHO ---
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
            showStatus('üóëÔ∏è Item removido', 'gray');
        }

        // --- NOVA BUSCA ---
        function newSearch() {
            document.getElementById('result').classList.add('hidden');
            document.getElementById('scannedCode').focus();
            showStatus('üîç Pronto para nova busca', 'blue');
        }

        // --- LEITOR WEB (ALTERNATIVO) ---
        function openWebScanner() {
            document.getElementById('webScannerModal').classList.remove('hidden');
            showStatus('üì∑ Tentando abrir leitor web...', 'blue');
            
            // Aqui voc√™ pode integrar uma biblioteca web se quiser
            // Por enquanto, √© apenas um placeholder
            setTimeout(() => {
                showStatus('‚ùå Leitor web n√£o dispon√≠vel neste navegador', 'red');
                setTimeout(closeWebScanner, 2000);
            }, 3000);
        }

        function closeWebScanner() {
            document.getElementById('webScannerModal').classList.add('hidden');
        }

        // --- MOSTRAR STATUS ---
        function showStatus(message, color) {
            const statusElement = document.getElementById('status');
            const colorClass = {
                blue: 'text-blue-600',
                green: 'text-green-600',
                red: 'text-red-600',
                gray: 'text-gray-600'
            }[color] || 'text-gray-600';
            
            statusElement.innerHTML = `<div class="text-sm ${colorClass}">${message}</div>`;
        }

        // --- INICIALIZA√á√ÉO ---
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('‚ö° Use o app "Leitor QR" do seu celular', 'blue');
            document.getElementById('scannedCode').focus();
            
            // Enter nos inputs
            document.getElementById('scannedCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') processScannedCode();
            });
            
            document.getElementById('quickInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') processQuickInput();
            });
        });
    </script>
</body>
</html>
